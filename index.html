<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCPP Advanced Monitor - Real-time Insights</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="sidebar-logo-text">OCPP Monitor</div>
                </div>
            </div>

            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a class="nav-item active" onclick="switchView('dashboard')">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a class="nav-item" onclick="switchView('realtime')">
                        <i class="fas fa-bolt"></i>
                        <span>Real-time Monitor</span>
                    </a>
                    <a class="nav-item" onclick="switchView('analytics')">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Data</div>
                    <a class="nav-item" onclick="switchView('overstay')">
                        <i class="fas fa-clock"></i>
                        <span>Transaction Records</span>
                        <span class="nav-badge" id="overstayBadge">0</span>
                    </a>
                    <a class="nav-item" onclick="switchView('stations')">
                        <i class="fas fa-charging-station"></i>
                        <span>Stations & Chargers</span>
                    </a>
                    <a class="nav-item" onclick="switchView('transactions')">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Transactions</span>
                    </a>
                    <a class="nav-item" onclick="switchView('anomalies')">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Anomalies</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a class="nav-item" onclick="switchView('logs')">
                        <i class="fas fa-file-alt"></i>
                        <span>System Logs</span>
                    </a>
                    <a class="nav-item" onclick="switchView('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </div>

            <!-- Logout Button -->
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <div class="page-title-section">
                        <h1 id="pageTitle">Dashboard</h1>
                        <p class="page-subtitle" id="pageSubtitle">Real-time OCPP Monitoring System</p>
                    </div>
                    <div class="header-actions">
                        <div class="connection-badge" id="connectionBadge">
                            <div class="pulse-dot"></div>
                            <span>CONNECTED</span>
                        </div>
                        <div class="auto-refresh-control">
                            <label class="switch">
                                <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()">
                                <span class="slider"></span>
                            </label>
                            <span class="auto-refresh-label">Connect</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Dashboard View -->
                <div id="dashboardView" class="view-section active">
                    <!-- Simple Action Panel -->
                    <div class="control-panel">
                        <div class="btn-group">
                            <button class="btn-primary" onclick="refreshData()">
                                <i class="fas fa-sync-alt"></i> Refresh All
                            </button>
                            <button class="btn-primary" onclick="runDiagnostics()">
                                <i class="fas fa-search"></i> Run Diagnostics
                            </button>
                            <button class="btn-secondary" onclick="exportReport()">
                                <i class="fas fa-file-export"></i> Export Report
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Total Energy</div>
                                <div class="stat-icon"><i class="fas fa-bolt"></i></div>
                            </div>
                            <div class="stat-value" id="totalEnergy">0 kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Active Sessions</div>
                                <div class="stat-icon"><i class="fas fa-charging-station"></i></div>
                            </div>
                            <div class="stat-value" id="activeSessions">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">System Health</div>
                                <div class="stat-icon"><i class="fas fa-heartbeat"></i></div>
                            </div>
                            <div class="stat-value" id="systemHealth">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Avg Power</div>
                                <div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
                            </div>
                            <div class="stat-value" id="avgPower">0 kW</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Online Chargers</div>
                                <div class="stat-icon"><i class="fas fa-plug"></i></div>
                            </div>
                            <div class="stat-value" id="onlineChargers">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Overstays Today</div>
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            </div>
                            <div class="stat-value" id="overstayCount">0</div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title"><i class="fas fa-chart-line"></i> Power Timeline</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="powerChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title"><i class="fas fa-wave-square"></i> Voltage Analysis</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="voltageChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-brain"></i></div>
                                AI-Powered Insights
                            </div>
                        </div>
                        <div class="insights-grid" id="insightsGrid"></div>
                    </div>
                </div>

                <!-- Overstay View -->
                <div id="overstayView" class="view-section">
                    <!-- Date Filter Panel -->
                    <div class="control-panel">
                        <h3 style="margin-bottom: 16px;">Filter Transaction Records</h3>
                        <div class="control-grid">
                            <div class="input-group">
                                <label>From Date</label>
                                <input type="date" id="overstayFromDate">
                            </div>
                            <div class="input-group">
                                <label>To Date</label>
                                <input type="date" id="overstayToDate">
                            </div>
                            <div class="input-group">
                                <label>Station Filter</label>
                                <select id="overstayStationFilter">
                                    <option value="">All Stations</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Show Only</label>
                                <select id="overstayOnlyFilter">
                                    <option value="all">All Transactions</option>
                                    <option value="overstay">Overstays Only (30+ min)</option>
                                    <option value="no-overstay">No Overstay</option>
                                </select>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn-primary" onclick="applyOverstayFilter()">
                                <i class="fas fa-filter"></i> Apply Filter
                            </button>
                            <button class="btn-secondary" onclick="clearOverstayFilter()">
                                <i class="fas fa-times"></i> Clear Filter
                            </button>
                            <button class="btn-secondary" onclick="exportOverstayData()">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Total Overstays</div>
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            </div>
                            <div class="stat-value" id="totalOverstays">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Avg Overstay Time</div>
                                <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                            </div>
                            <div class="stat-value" id="avgOverstayTime">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-label">Max Overstay Time</div>
                                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                            </div>
                            <div class="stat-value" id="maxOverstayTime">--</div>
                        </div>
                    </div>

                    <div class="overstay-table-container">
                        <div class="section-header">
                            <h2 class="section-title">Transaction Records</h2>
                        </div>
                        <table class="overstay-table">
                            <thead>
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>User</th>
                                    <th>Station</th>
                                    <th>End Time</th>
                                    <th>Unplugged</th>
                                    <th>Overstay Duration</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="overstayTableBody">
                                <tr>
                                    <td colspan="7">
                                        <div class="loading">
                                            <div class="loading-spinner"></div>
                                            Loading transaction records...
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Pagination Controls -->
                        <div class="pagination-container" id="paginationContainer" style="display: none;">
                            <div class="pagination-info" id="paginationInfo">
                                Showing 1-10 of 0 records
                            </div>
                            <div class="pagination-controls">
                                <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)">
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <div class="page-numbers" id="pageNumbers"></div>
                                <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)">
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stations & Chargers View -->
                <div id="stationsView" class="view-section">
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-charging-station"></i></div>
                                Charging Stations & Chargers
                            </div>
                            <button class="btn-secondary" onclick="refreshStations()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="station-grid" id="stationGrid">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading stations...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time View -->
                <div id="realtimeView" class="view-section">
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-plug"></i></div>
                                Active Charging Sessions
                            </div>
                            <span id="transactionCount" style="color: var(--primary); font-weight: 700;">0 Active</span>
                        </div>
                        <div class="transaction-list" id="transactionList">
                            <div class="loading">No active transactions</div>
                        </div>
                    </div>
                </div>

                <!-- Analytics View -->
                <div id="analyticsView" class="view-section">
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title"><i class="fas fa-battery-three-quarters"></i> Session Distribution</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="sessionChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title"><i class="fas fa-thermometer-half"></i> Temperature Monitoring</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="temperatureChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Anomalies View -->
                <div id="anomaliesView" class="view-section">
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-shield-alt"></i></div>
                                Anomaly Detection
                            </div>
                            <span id="anomalyCount" style="color: var(--danger); font-weight: 700;">0 Anomalies</span>
                        </div>
                        <div class="anomaly-list" id="anomalyList">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Running anomaly detection...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions View -->
                <div id="transactionsView" class="view-section">
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-exchange-alt"></i></div>
                                All Transactions
                            </div>
                        </div>
                        <div class="transaction-list" id="allTransactionList">
                            <div class="loading">Loading transactions...</div>
                        </div>
                    </div>
                </div>

                <!-- Logs View -->
                <div id="logsView" class="view-section">
                    <div class="insights-section">
                        <div class="section-header">
                            <div class="section-title">
                                <div class="section-icon"><i class="fas fa-file-alt"></i></div>
                                System Logs
                            </div>
                            <button class="btn-secondary" onclick="exportLogs()">
                                <i class="fas fa-download"></i> Export Logs
                            </button>
                        </div>
                        <div class="logs-container" id="logsContainer">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading system logs...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settingsView" class="view-section">
                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-server"></i> Server Configuration</h3>
                        <div class="control-grid">
                            <div class="input-group">
                                <label>Server URL</label>
                                <input type="text" id="settingsServerUrl" value="https://c7tst.tesi.com.ph:8041">
                            </div>
                            <div class="input-group">
                                <label>Default Log Limit</label>
                                <input type="number" id="settingsLogLimit" value="100" min="10" max="1000">
                            </div>
                            <div class="input-group">
                                <label>Refresh Interval (seconds)</label>
                                <input type="number" id="settingsRefreshInterval" value="5" min="1" max="60">
                            </div>
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-filter"></i> Data Analysis Settings</h3>
                        <div class="control-grid">
                            <div class="input-group">
                                <label>Time Range</label>
                                <select id="settingsTimeRange">
                                    <option value="1h">Last Hour</option>
                                    <option value="6h">Last 6 Hours</option>
                                    <option value="24h" selected>Last 24 Hours</option>
                                    <option value="7d">Last 7 Days</option>
                                    <option value="30d">Last 30 Days</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Analysis Mode</label>
                                <select id="settingsAnalysisMode">
                                    <option value="realtime">Real-time</option>
                                    <option value="historical">Historical</option>
                                    <option value="predictive">Predictive</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="control-panel">
                        <div class="btn-group">
                            <button class="btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <button class="btn-secondary" onclick="resetSettings()">
                                <i class="fas fa-undo"></i> Reset to Default
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Toggle Button -->
        <button class="mobile-toggle" id="mobileToggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
</body>
</html>
